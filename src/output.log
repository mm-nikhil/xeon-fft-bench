============================================================
  FFT BENCHMARK RUN
  Date     : Wed Feb 18 10:30:26 IST 2026
  Hostname : amdtoolsserver.morphingmachines
  Log file : ./fft_logs/fft_benchmark_20260218_103026.log
============================================================

[SETUP] Sourcing Intel oneAPI environment if available...

[CHECK] MKL environment:
        MKLROOT     = /home/nikhil/.local
        Include dir = /home/nikhil/.local/include
        Lib dir     = /home/nikhil/.local/lib
        Runtime lib = -l:libmkl_rt.so.2

[CHECK] Compiler availability:
        gcc found: gcc (GCC) 8.5.0 20210514 (Red Hat 8.5.0-22)

[INFO] BENCH_NRUNS=5, BENCH_WARMUP=2
[INFO] KMP_AFFINITY=scatter,granularity=fine
[INFO] NOTE: MKL chooses kernels at runtime; ISA is controlled with MKL_ENABLE_INSTRUCTIONS.

------------------------------------------------------------
[COMPILE] Scenario 1 binary: gcc -O2 -std=c99
------------------------------------------------------------
          Binary: fft_cpu_only

------------------------------------------------------------
[COMPILE] Scenario 2/3 binary: gcc -O3 -mavx512f -mavx512dq -mavx512bw -mavx512vl -std=c99
------------------------------------------------------------
          Binary: fft_avx512

============================================================
 RUNNING: Scenario 1 — CPU baseline (single thread)
 Binary : fft_cpu_only
 Threads: 1
 ISA    : SSE4_2
============================================================


########################################################
#         FFT BENCHMARK — Intel MKL DFT                #
#         Random Initialized 3D Complex FFT             #
########################################################
MKL max threads available : 1
Threads requested (cli)   : 1
Timed runs per config     : 5
Warmup runs               : 2 (untimed, stabilize AVX freq)

Column guide:
  Fwd = forward FFT (time + GFLOPS)
  Bwd = inverse FFT (time + GFLOPS)
  Mem = total memory used by in+out buffers

Cache reference (W-2155):
  L1d  32KB  → fits 1D FFT N < 2K complex doubles
  L2    1MB  → fits 3D FFT up to ~40^3
  L3   14MB  → fits 3D FFT up to ~96^3  (64^3 = 4MB  ✓)
  DRAM       → 128^3 = 32MB  (spills L3)   256^3 = 256MB

========================================================================================
  SCENARIO 1 — CPU ONLY (1 thread, scalar baseline)
========================================================================================
  NOTE: Set by compile flag -O2  — no explicit AVX enabled

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    2.142 ms    11.02 GFLOPS | Bwd:    2.133 ms    11.06 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:   11.746 ms     8.03 GFLOPS | Bwd:   11.754 ms     8.03 GFLOPS | Mem:   32.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   29.556 ms     7.45 GFLOPS | Bwd:   29.175 ms     7.55 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:  119.479 ms     7.37 GFLOPS | Bwd:  120.588 ms     7.30 GFLOPS | Mem:  256.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  277.304 ms     7.26 GFLOPS | Bwd:  280.875 ms     7.17 GFLOPS | Mem:  512.0 MB

========================================================================================
  SCENARIO 2 — CPU + AVX-512 (1 thread, vectorized)
========================================================================================
  NOTE: Effective only when compiled with -xCORE-AVX512
        MKL selects AVX-512 kernel automatically

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    2.150 ms    10.97 GFLOPS | Bwd:    2.167 ms    10.89 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:   11.946 ms     7.90 GFLOPS | Bwd:   11.898 ms     7.93 GFLOPS | Mem:   32.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   29.337 ms     7.51 GFLOPS | Bwd:   29.677 ms     7.42 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:  120.212 ms     7.33 GFLOPS | Bwd:  119.740 ms     7.36 GFLOPS | Mem:  256.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  279.081 ms     7.21 GFLOPS | Bwd:  281.882 ms     7.14 GFLOPS | Mem:  512.0 MB

========================================================================================
  SCENARIO 3 — AVX-512 + Multithreaded
========================================================================================
  Threads: 1  (override with: ./fft_benchmark <N>)

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    2.144 ms    11.01 GFLOPS | Bwd:    2.194 ms    10.75 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:   11.936 ms     7.91 GFLOPS | Bwd:   11.707 ms     8.06 GFLOPS | Mem:   32.0 MB
64^3 batch=16          | Grid:   64x  64x  64 | Batch: 16 | Thr: 1 | Fwd:   49.018 ms     7.70 GFLOPS | Bwd:   48.291 ms     7.82 GFLOPS | Mem:  128.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   29.825 ms     7.38 GFLOPS | Bwd:   29.310 ms     7.51 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:  119.857 ms     7.35 GFLOPS | Bwd:  120.408 ms     7.32 GFLOPS | Mem:  256.0 MB
128^3 batch=16         | Grid:  128x 128x 128 | Batch: 16 | Thr: 1 | Fwd:  477.773 ms     7.37 GFLOPS | Bwd:  479.800 ms     7.34 GFLOPS | Mem: 1024.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  279.211 ms     7.21 GFLOPS | Bwd:  281.821 ms     7.14 GFLOPS | Mem:  512.0 MB
256^3 batch=4          | Grid:  256x 256x 256 | Batch:  4 | Thr: 1 | Fwd: 1039.327 ms     7.75 GFLOPS | Bwd: 1118.068 ms     7.20 GFLOPS | Mem: 2048.0 MB

========================================================================================
  SCENARIO 4 — Thread Scaling Sweep (128^3 batch=4)
========================================================================================
  Shows how FFT scales across your 10 physical cores

128^3 thr=1            | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:  119.121 ms     7.39 GFLOPS | Bwd:  120.522 ms     7.31 GFLOPS | Mem:  256.0 MB
128^3 thr=2            | Grid:  128x 128x 128 | Batch:  4 | Thr: 2 | Fwd:   63.547 ms    13.86 GFLOPS | Bwd:   62.510 ms    14.09 GFLOPS | Mem:  256.0 MB
128^3 thr=4            | Grid:  128x 128x 128 | Batch:  4 | Thr: 4 | Fwd:   34.583 ms    25.47 GFLOPS | Bwd:   33.466 ms    26.32 GFLOPS | Mem:  256.0 MB
128^3 thr=8            | Grid:  128x 128x 128 | Batch:  4 | Thr: 8 | Fwd:   22.571 ms    39.02 GFLOPS | Bwd:   20.730 ms    42.49 GFLOPS | Mem:  256.0 MB
128^3 thr=10           | Grid:  128x 128x 128 | Batch:  4 | Thr:10 | Fwd:   25.179 ms    34.98 GFLOPS | Bwd:   24.363 ms    36.15 GFLOPS | Mem:  256.0 MB
128^3 thr=20           | Grid:  128x 128x 128 | Batch:  4 | Thr:20 | Fwd:   23.081 ms    38.16 GFLOPS | Bwd:   21.287 ms    41.38 GFLOPS | Mem:  256.0 MB

========================================================================================
  SCENARIO 5 — Batch Scaling Sweep (128^3, max threads)
========================================================================================
  Shows benefit of batched FFT vs repeated single calls

128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   29.987 ms     7.34 GFLOPS | Bwd:   29.622 ms     7.43 GFLOPS | Mem:   64.0 MB
128^3 batch=2          | Grid:  128x 128x 128 | Batch:  2 | Thr: 1 | Fwd:   59.863 ms     7.36 GFLOPS | Bwd:   60.098 ms     7.33 GFLOPS | Mem:  128.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:  135.116 ms     6.52 GFLOPS | Bwd:  118.886 ms     7.41 GFLOPS | Mem:  256.0 MB
128^3 batch=8          | Grid:  128x 128x 128 | Batch:  8 | Thr: 1 | Fwd:  251.535 ms     7.00 GFLOPS | Bwd:  235.742 ms     7.47 GFLOPS | Mem:  512.0 MB
128^3 batch=16         | Grid:  128x 128x 128 | Batch: 16 | Thr: 1 | Fwd:  496.830 ms     7.09 GFLOPS | Bwd:  499.570 ms     7.05 GFLOPS | Mem: 1024.0 MB
128^3 batch=32         | Grid:  128x 128x 128 | Batch: 32 | Thr: 1 | Fwd:  875.634 ms     8.05 GFLOPS | Bwd:  997.275 ms     7.07 GFLOPS | Mem: 2048.0 MB

########################################################
#                  BENCHMARK COMPLETE                  #
########################################################


real	1m9.888s
user	1m19.010s
sys	0m1.198s

[DONE] Scenario 1 complete

============================================================
 RUNNING: Scenario 2 — AVX-512 (single thread)
 Binary : fft_avx512
 Threads: 1
 ISA    : AVX512
============================================================


########################################################
#         FFT BENCHMARK — Intel MKL DFT                #
#         Random Initialized 3D Complex FFT             #
########################################################
MKL max threads available : 1
Threads requested (cli)   : 1
Timed runs per config     : 5
Warmup runs               : 2 (untimed, stabilize AVX freq)

Column guide:
  Fwd = forward FFT (time + GFLOPS)
  Bwd = inverse FFT (time + GFLOPS)
  Mem = total memory used by in+out buffers

Cache reference (W-2155):
  L1d  32KB  → fits 1D FFT N < 2K complex doubles
  L2    1MB  → fits 3D FFT up to ~40^3
  L3   14MB  → fits 3D FFT up to ~96^3  (64^3 = 4MB  ✓)
  DRAM       → 128^3 = 32MB  (spills L3)   256^3 = 256MB

========================================================================================
  SCENARIO 1 — CPU ONLY (1 thread, scalar baseline)
========================================================================================
  NOTE: Set by compile flag -O2  — no explicit AVX enabled

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    1.249 ms    18.90 GFLOPS | Bwd:    1.317 ms    17.91 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:    8.767 ms    10.76 GFLOPS | Bwd:    8.691 ms    10.86 GFLOPS | Mem:   32.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   21.606 ms    10.19 GFLOPS | Bwd:   21.858 ms    10.07 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   85.963 ms    10.25 GFLOPS | Bwd:   86.703 ms    10.16 GFLOPS | Mem:  256.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  248.054 ms     8.12 GFLOPS | Bwd:  248.683 ms     8.10 GFLOPS | Mem:  512.0 MB

========================================================================================
  SCENARIO 2 — CPU + AVX-512 (1 thread, vectorized)
========================================================================================
  NOTE: Effective only when compiled with -xCORE-AVX512
        MKL selects AVX-512 kernel automatically

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    1.161 ms    20.31 GFLOPS | Bwd:    1.162 ms    20.30 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:    7.611 ms    12.40 GFLOPS | Bwd:    7.317 ms    12.90 GFLOPS | Mem:   32.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   20.543 ms    10.72 GFLOPS | Bwd:   20.261 ms    10.87 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   84.205 ms    10.46 GFLOPS | Bwd:   85.418 ms    10.31 GFLOPS | Mem:  256.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  244.873 ms     8.22 GFLOPS | Bwd:  248.027 ms     8.12 GFLOPS | Mem:  512.0 MB

========================================================================================
  SCENARIO 3 — AVX-512 + Multithreaded
========================================================================================
  Threads: 1  (override with: ./fft_benchmark <N>)

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    1.115 ms    21.17 GFLOPS | Bwd:    1.116 ms    21.14 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:    7.489 ms    12.60 GFLOPS | Bwd:    7.157 ms    13.19 GFLOPS | Mem:   32.0 MB
64^3 batch=16          | Grid:   64x  64x  64 | Batch: 16 | Thr: 1 | Fwd:   36.505 ms    10.34 GFLOPS | Bwd:   36.876 ms    10.24 GFLOPS | Mem:  128.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   19.924 ms    11.05 GFLOPS | Bwd:   20.378 ms    10.81 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   84.558 ms    10.42 GFLOPS | Bwd:   85.322 ms    10.32 GFLOPS | Mem:  256.0 MB
128^3 batch=16         | Grid:  128x 128x 128 | Batch: 16 | Thr: 1 | Fwd:  339.260 ms    10.39 GFLOPS | Bwd:  344.923 ms    10.21 GFLOPS | Mem: 1024.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  242.396 ms     8.31 GFLOPS | Bwd:  248.724 ms     8.09 GFLOPS | Mem:  512.0 MB
256^3 batch=4          | Grid:  256x 256x 256 | Batch:  4 | Thr: 1 | Fwd:  829.818 ms     9.70 GFLOPS | Bwd:  997.032 ms     8.08 GFLOPS | Mem: 2048.0 MB

========================================================================================
  SCENARIO 4 — Thread Scaling Sweep (128^3 batch=4)
========================================================================================
  Shows how FFT scales across your 10 physical cores

128^3 thr=1            | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   84.184 ms    10.46 GFLOPS | Bwd:   84.965 ms    10.37 GFLOPS | Mem:  256.0 MB
128^3 thr=2            | Grid:  128x 128x 128 | Batch:  4 | Thr: 2 | Fwd:   45.717 ms    19.27 GFLOPS | Bwd:   45.172 ms    19.50 GFLOPS | Mem:  256.0 MB
128^3 thr=4            | Grid:  128x 128x 128 | Batch:  4 | Thr: 4 | Fwd:   25.018 ms    35.21 GFLOPS | Bwd:   25.590 ms    34.42 GFLOPS | Mem:  256.0 MB
128^3 thr=8            | Grid:  128x 128x 128 | Batch:  4 | Thr: 8 | Fwd:   17.875 ms    49.28 GFLOPS | Bwd:   17.892 ms    49.23 GFLOPS | Mem:  256.0 MB
128^3 thr=10           | Grid:  128x 128x 128 | Batch:  4 | Thr:10 | Fwd:   14.591 ms    60.37 GFLOPS | Bwd:   14.466 ms    60.89 GFLOPS | Mem:  256.0 MB
128^3 thr=20           | Grid:  128x 128x 128 | Batch:  4 | Thr:20 | Fwd:   16.544 ms    53.24 GFLOPS | Bwd:   14.739 ms    59.76 GFLOPS | Mem:  256.0 MB

========================================================================================
  SCENARIO 5 — Batch Scaling Sweep (128^3, max threads)
========================================================================================
  Shows benefit of batched FFT vs repeated single calls

128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   20.129 ms    10.94 GFLOPS | Bwd:   20.380 ms    10.80 GFLOPS | Mem:   64.0 MB
128^3 batch=2          | Grid:  128x 128x 128 | Batch:  2 | Thr: 1 | Fwd:   41.780 ms    10.54 GFLOPS | Bwd:   43.696 ms    10.08 GFLOPS | Mem:  128.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   85.032 ms    10.36 GFLOPS | Bwd:   85.853 ms    10.26 GFLOPS | Mem:  256.0 MB
128^3 batch=8          | Grid:  128x 128x 128 | Batch:  8 | Thr: 1 | Fwd:  170.435 ms    10.34 GFLOPS | Bwd:  171.778 ms    10.26 GFLOPS | Mem:  512.0 MB
128^3 batch=16         | Grid:  128x 128x 128 | Batch: 16 | Thr: 1 | Fwd:  338.695 ms    10.40 GFLOPS | Bwd:  353.263 ms     9.97 GFLOPS | Mem: 1024.0 MB
128^3 batch=32         | Grid:  128x 128x 128 | Batch: 32 | Thr: 1 | Fwd:  596.340 ms    11.82 GFLOPS | Bwd:  713.980 ms     9.87 GFLOPS | Mem: 2048.0 MB

########################################################
#                  BENCHMARK COMPLETE                  #
########################################################


real	0m55.066s
user	1m1.392s
sys	0m1.261s

[DONE] Scenario 2 complete

============================================================
 RUNNING: Scenario 3 — AVX-512 + physical cores
 Binary : fft_avx512
 Threads: 10
 ISA    : AVX512
============================================================


########################################################
#         FFT BENCHMARK — Intel MKL DFT                #
#         Random Initialized 3D Complex FFT             #
########################################################
MKL max threads available : 10
Threads requested (cli)   : 10
Timed runs per config     : 5
Warmup runs               : 2 (untimed, stabilize AVX freq)

Column guide:
  Fwd = forward FFT (time + GFLOPS)
  Bwd = inverse FFT (time + GFLOPS)
  Mem = total memory used by in+out buffers

Cache reference (W-2155):
  L1d  32KB  → fits 1D FFT N < 2K complex doubles
  L2    1MB  → fits 3D FFT up to ~40^3
  L3   14MB  → fits 3D FFT up to ~96^3  (64^3 = 4MB  ✓)
  DRAM       → 128^3 = 32MB  (spills L3)   256^3 = 256MB

========================================================================================
  SCENARIO 1 — CPU ONLY (1 thread, scalar baseline)
========================================================================================
  NOTE: Set by compile flag -O2  — no explicit AVX enabled

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    1.373 ms    17.18 GFLOPS | Bwd:    1.384 ms    17.05 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:    8.720 ms    10.82 GFLOPS | Bwd:    8.499 ms    11.10 GFLOPS | Mem:   32.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   21.721 ms    10.14 GFLOPS | Bwd:   22.348 ms     9.85 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   89.959 ms     9.79 GFLOPS | Bwd:   91.848 ms     9.59 GFLOPS | Mem:  256.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  247.796 ms     8.12 GFLOPS | Bwd:  262.219 ms     7.68 GFLOPS | Mem:  512.0 MB

========================================================================================
  SCENARIO 2 — CPU + AVX-512 (1 thread, vectorized)
========================================================================================
  NOTE: Effective only when compiled with -xCORE-AVX512
        MKL selects AVX-512 kernel automatically

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    1.487 ms    15.86 GFLOPS | Bwd:    1.539 ms    15.33 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:    8.948 ms    10.55 GFLOPS | Bwd:    8.476 ms    11.13 GFLOPS | Mem:   32.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   22.350 ms     9.85 GFLOPS | Bwd:   23.319 ms     9.44 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   86.708 ms    10.16 GFLOPS | Bwd:   89.357 ms     9.86 GFLOPS | Mem:  256.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  240.544 ms     8.37 GFLOPS | Bwd:  247.039 ms     8.15 GFLOPS | Mem:  512.0 MB

========================================================================================
  SCENARIO 3 — AVX-512 + Multithreaded
========================================================================================
  Threads: 10  (override with: ./fft_benchmark <N>)

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr:10 | Fwd:    0.264 ms    89.45 GFLOPS | Bwd:    0.264 ms    89.42 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr:10 | Fwd:    1.139 ms    82.83 GFLOPS | Bwd:    1.216 ms    77.60 GFLOPS | Mem:   32.0 MB
64^3 batch=16          | Grid:   64x  64x  64 | Batch: 16 | Thr:10 | Fwd:    7.363 ms    51.27 GFLOPS | Bwd:    7.421 ms    50.87 GFLOPS | Mem:  128.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr:10 | Fwd:    4.149 ms    53.08 GFLOPS | Bwd:    4.228 ms    52.08 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr:10 | Fwd:   18.122 ms    48.60 GFLOPS | Bwd:   19.142 ms    46.01 GFLOPS | Mem:  256.0 MB
128^3 batch=16         | Grid:  128x 128x 128 | Batch: 16 | Thr:10 | Fwd:   65.324 ms    53.93 GFLOPS | Bwd:   71.337 ms    49.39 GFLOPS | Mem: 1024.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr:10 | Fwd:   41.646 ms    48.34 GFLOPS | Bwd:   44.070 ms    45.68 GFLOPS | Mem:  512.0 MB
256^3 batch=4          | Grid:  256x 256x 256 | Batch:  4 | Thr:10 | Fwd:  147.897 ms    54.45 GFLOPS | Bwd:  154.453 ms    52.14 GFLOPS | Mem: 2048.0 MB

========================================================================================
  SCENARIO 4 — Thread Scaling Sweep (128^3 batch=4)
========================================================================================
  Shows how FFT scales across your 10 physical cores

128^3 thr=1            | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   89.012 ms     9.90 GFLOPS | Bwd:   91.499 ms     9.63 GFLOPS | Mem:  256.0 MB
128^3 thr=2            | Grid:  128x 128x 128 | Batch:  4 | Thr: 2 | Fwd:   49.289 ms    17.87 GFLOPS | Bwd:   57.069 ms    15.43 GFLOPS | Mem:  256.0 MB
128^3 thr=4            | Grid:  128x 128x 128 | Batch:  4 | Thr: 4 | Fwd:   26.919 ms    32.72 GFLOPS | Bwd:   26.766 ms    32.91 GFLOPS | Mem:  256.0 MB
128^3 thr=8            | Grid:  128x 128x 128 | Batch:  4 | Thr: 8 | Fwd:   21.125 ms    41.69 GFLOPS | Bwd:   21.757 ms    40.48 GFLOPS | Mem:  256.0 MB
128^3 thr=10           | Grid:  128x 128x 128 | Batch:  4 | Thr:10 | Fwd:   18.644 ms    47.24 GFLOPS | Bwd:   18.663 ms    47.20 GFLOPS | Mem:  256.0 MB
128^3 thr=20           | Grid:  128x 128x 128 | Batch:  4 | Thr:20 | Fwd:   20.714 ms    42.52 GFLOPS | Bwd:   23.178 ms    38.00 GFLOPS | Mem:  256.0 MB

========================================================================================
  SCENARIO 5 — Batch Scaling Sweep (128^3, max threads)
========================================================================================
  Shows benefit of batched FFT vs repeated single calls

128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr:10 | Fwd:    4.468 ms    49.28 GFLOPS | Bwd:    4.392 ms    50.13 GFLOPS | Mem:   64.0 MB
128^3 batch=2          | Grid:  128x 128x 128 | Batch:  2 | Thr:10 | Fwd:    8.635 ms    51.00 GFLOPS | Bwd:    9.183 ms    47.96 GFLOPS | Mem:  128.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr:10 | Fwd:   18.291 ms    48.16 GFLOPS | Bwd:   18.021 ms    48.88 GFLOPS | Mem:  256.0 MB
128^3 batch=8          | Grid:  128x 128x 128 | Batch:  8 | Thr:10 | Fwd:   32.815 ms    53.68 GFLOPS | Bwd:   38.154 ms    46.17 GFLOPS | Mem:  512.0 MB
128^3 batch=16         | Grid:  128x 128x 128 | Batch: 16 | Thr:10 | Fwd:   64.589 ms    54.55 GFLOPS | Bwd:   74.046 ms    47.58 GFLOPS | Mem: 1024.0 MB
128^3 batch=32         | Grid:  128x 128x 128 | Batch: 32 | Thr:10 | Fwd:  125.292 ms    56.24 GFLOPS | Bwd:  140.692 ms    50.08 GFLOPS | Mem: 2048.0 MB

########################################################
#                  BENCHMARK COMPLETE                  #
########################################################


real	0m30.189s
user	1m30.920s
sys	0m1.863s

[DONE] Scenario 3 complete

============================================================
 RUNNING: Scenario 3b — AVX-512 + logical cores (hyperthreading)
 Binary : fft_avx512
 Threads: 20
 ISA    : AVX512
============================================================


########################################################
#         FFT BENCHMARK — Intel MKL DFT                #
#         Random Initialized 3D Complex FFT             #
########################################################
MKL max threads available : 20
Threads requested (cli)   : 20
Timed runs per config     : 5
Warmup runs               : 2 (untimed, stabilize AVX freq)

Column guide:
  Fwd = forward FFT (time + GFLOPS)
  Bwd = inverse FFT (time + GFLOPS)
  Mem = total memory used by in+out buffers

Cache reference (W-2155):
  L1d  32KB  → fits 1D FFT N < 2K complex doubles
  L2    1MB  → fits 3D FFT up to ~40^3
  L3   14MB  → fits 3D FFT up to ~96^3  (64^3 = 4MB  ✓)
  DRAM       → 128^3 = 32MB  (spills L3)   256^3 = 256MB

========================================================================================
  SCENARIO 1 — CPU ONLY (1 thread, scalar baseline)
========================================================================================
  NOTE: Set by compile flag -O2  — no explicit AVX enabled

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    1.391 ms    16.96 GFLOPS | Bwd:    1.367 ms    17.26 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:    8.469 ms    11.14 GFLOPS | Bwd:    8.552 ms    11.04 GFLOPS | Mem:   32.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   21.719 ms    10.14 GFLOPS | Bwd:   21.474 ms    10.25 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   88.822 ms     9.92 GFLOPS | Bwd:   89.051 ms     9.89 GFLOPS | Mem:  256.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  208.582 ms     9.65 GFLOPS | Bwd:  245.266 ms     8.21 GFLOPS | Mem:  512.0 MB

========================================================================================
  SCENARIO 2 — CPU + AVX-512 (1 thread, vectorized)
========================================================================================
  NOTE: Effective only when compiled with -xCORE-AVX512
        MKL selects AVX-512 kernel automatically

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    1.384 ms    17.05 GFLOPS | Bwd:    1.374 ms    17.18 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:    8.457 ms    11.16 GFLOPS | Bwd:    8.284 ms    11.39 GFLOPS | Mem:   32.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   21.835 ms    10.08 GFLOPS | Bwd:   22.221 ms     9.91 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   88.242 ms     9.98 GFLOPS | Bwd:   89.282 ms     9.87 GFLOPS | Mem:  256.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  246.234 ms     8.18 GFLOPS | Bwd:  243.620 ms     8.26 GFLOPS | Mem:  512.0 MB

========================================================================================
  SCENARIO 3 — AVX-512 + Multithreaded
========================================================================================
  Threads: 20  (override with: ./fft_benchmark <N>)

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr:20 | Fwd:   11.204 ms     2.11 GFLOPS | Bwd:   12.942 ms     1.82 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr:20 | Fwd:   10.216 ms     9.24 GFLOPS | Bwd:    9.961 ms     9.47 GFLOPS | Mem:   32.0 MB
64^3 batch=16          | Grid:   64x  64x  64 | Batch: 16 | Thr:20 | Fwd:   13.021 ms    28.99 GFLOPS | Bwd:   13.006 ms    29.02 GFLOPS | Mem:  128.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr:20 | Fwd:   10.900 ms    20.20 GFLOPS | Bwd:   10.945 ms    20.12 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr:20 | Fwd:   17.010 ms    51.78 GFLOPS | Bwd:   16.992 ms    51.84 GFLOPS | Mem:  256.0 MB
128^3 batch=16         | Grid:  128x 128x 128 | Batch: 16 | Thr:20 | Fwd:   64.180 ms    54.90 GFLOPS | Bwd:   76.570 ms    46.01 GFLOPS | Mem: 1024.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr:20 | Fwd:   50.667 ms    39.74 GFLOPS | Bwd:   75.871 ms    26.54 GFLOPS | Mem:  512.0 MB
256^3 batch=4          | Grid:  256x 256x 256 | Batch:  4 | Thr:20 | Fwd:  185.715 ms    43.36 GFLOPS | Bwd:  194.962 ms    41.31 GFLOPS | Mem: 2048.0 MB

========================================================================================
  SCENARIO 4 — Thread Scaling Sweep (128^3 batch=4)
========================================================================================
  Shows how FFT scales across your 10 physical cores

128^3 thr=1            | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   89.136 ms     9.88 GFLOPS | Bwd:   91.618 ms     9.61 GFLOPS | Mem:  256.0 MB
128^3 thr=2            | Grid:  128x 128x 128 | Batch:  4 | Thr: 2 | Fwd:   48.387 ms    18.20 GFLOPS | Bwd:   47.633 ms    18.49 GFLOPS | Mem:  256.0 MB
128^3 thr=4            | Grid:  128x 128x 128 | Batch:  4 | Thr: 4 | Fwd:   31.753 ms    27.74 GFLOPS | Bwd:   33.152 ms    26.57 GFLOPS | Mem:  256.0 MB
128^3 thr=8            | Grid:  128x 128x 128 | Batch:  4 | Thr: 8 | Fwd:   20.937 ms    42.07 GFLOPS | Bwd:   21.670 ms    40.65 GFLOPS | Mem:  256.0 MB
128^3 thr=10           | Grid:  128x 128x 128 | Batch:  4 | Thr:10 | Fwd:   17.910 ms    49.18 GFLOPS | Bwd:   18.171 ms    48.47 GFLOPS | Mem:  256.0 MB
128^3 thr=20           | Grid:  128x 128x 128 | Batch:  4 | Thr:20 | Fwd:   19.013 ms    46.33 GFLOPS | Bwd:   20.847 ms    42.25 GFLOPS | Mem:  256.0 MB

========================================================================================
  SCENARIO 5 — Batch Scaling Sweep (128^3, max threads)
========================================================================================
  Shows benefit of batched FFT vs repeated single calls

128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr:20 | Fwd:   13.889 ms    15.85 GFLOPS | Bwd:   16.255 ms    13.55 GFLOPS | Mem:   64.0 MB
128^3 batch=2          | Grid:  128x 128x 128 | Batch:  2 | Thr:20 | Fwd:   32.049 ms    13.74 GFLOPS | Bwd:   18.406 ms    23.93 GFLOPS | Mem:  128.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr:20 | Fwd:   19.711 ms    44.69 GFLOPS | Bwd:   19.717 ms    44.67 GFLOPS | Mem:  256.0 MB
128^3 batch=8          | Grid:  128x 128x 128 | Batch:  8 | Thr:20 | Fwd:   37.772 ms    46.64 GFLOPS | Bwd:   42.052 ms    41.89 GFLOPS | Mem:  512.0 MB
128^3 batch=16         | Grid:  128x 128x 128 | Batch: 16 | Thr:20 | Fwd:   72.165 ms    48.82 GFLOPS | Bwd:   73.002 ms    48.26 GFLOPS | Mem: 1024.0 MB
128^3 batch=32         | Grid:  128x 128x 128 | Batch: 32 | Thr:20 | Fwd:  116.792 ms    60.33 GFLOPS | Bwd:  135.486 ms    52.01 GFLOPS | Mem: 2048.0 MB

########################################################
#                  BENCHMARK COMPLETE                  #
########################################################


real	0m30.665s
user	2m38.711s
sys	0m1.913s

[DONE] Scenario 3b complete

============================================================
 EXTRA: MKL_VERBOSE=1 quick check
============================================================

MKL_VERBOSE oneMKL 2025 Update 3 Product build 20251007 for Intel(R) 64 architecture Intel(R) Advanced Vector Extensions 512 (Intel(R) AVX-512) enabled processors, Lnx 3.30GHz intel_thread
MKL_VERBOSE FFT(dcfi64x64x64,input_strides:{0,4096,64,1},output_strides:{0,4096,64,1},tLim:1,desc:0x64b480) 4.08ms CNR:OFF Dyn:0 FastMM:1 TID:0  NThr:1

============================================================
  SUMMARY (128^3 batch=4, Forward GFLOPS)
============================================================
  Scenario 1   : 7.37 GFLOPS
  Scenario 2   : 10.25 GFLOPS  (speedup vs S1: 1.39x)
  Scenario 3   : 48.60 GFLOPS (speedup vs S1: 6.59x)
  Scenario 3b  : 51.78 GFLOPS (speedup vs S1: 7.03x)
============================================================

============================================================
  ALL RUNS COMPLETE
  Log saved to: ./fft_logs/fft_benchmark_20260218_103026.log
  451 lines logged
  Run completed at: Wed Feb 18 10:33:34 IST 2026
============================================================

To inspect full output:
  cat ./fft_logs/fft_benchmark_20260218_103026.log

To extract scenario markers + GFLOPS:
  grep -E 'RUNNING:|SCENARIO|GFLOPS|SUMMARY' ./fft_logs/fft_benchmark_20260218_103026.log
