============================================================
  FFT BENCHMARK RUN
  Date     : Tue Feb 17 15:48:48 IST 2026
  Hostname : amdtoolsserver.morphingmachines
  Log file : ./fft_logs/fft_benchmark_20260217_154848.log
============================================================

[SETUP] Sourcing Intel oneAPI environment if available...

[CHECK] MKL environment:
        MKLROOT     = /home/nikhil/.local
        Include dir = /home/nikhil/.local/include
        Lib dir     = /home/nikhil/.local/lib
        Runtime lib = -l:libmkl_rt.so.2

[CHECK] Compiler availability:
        gcc found: gcc (GCC) 8.5.0 20210514 (Red Hat 8.5.0-22)

[INFO] BENCH_NRUNS=20, BENCH_WARMUP=5
[INFO] KMP_AFFINITY=scatter,granularity=fine
[INFO] NOTE: MKL chooses kernels at runtime; ISA is controlled with MKL_ENABLE_INSTRUCTIONS.

------------------------------------------------------------
[COMPILE] Scenario 1 binary: gcc -O2 -std=c99
------------------------------------------------------------
          Binary: fft_cpu_only

------------------------------------------------------------
[COMPILE] Scenario 2/3 binary: gcc -O3 -mavx512f -mavx512dq -mavx512bw -mavx512vl -std=c99
------------------------------------------------------------
          Binary: fft_avx512

============================================================
 RUNNING: Scenario 1 — CPU baseline (single thread)
 Binary : fft_cpu_only
 Threads: 1
 ISA    : SSE4_2
============================================================


########################################################
#         FFT BENCHMARK — Intel MKL DFT                #
#         Random Initialized 3D Complex FFT             #
########################################################
MKL max threads available : 1
Threads requested (cli)   : 1
Timed runs per config     : 20
Warmup runs               : 5 (untimed, stabilize AVX freq)

Column guide:
  Fwd = forward FFT (time + GFLOPS)
  Bwd = inverse FFT (time + GFLOPS)
  Mem = total memory used by in+out buffers

Cache reference (W-2155):
  L1d  32KB  → fits 1D FFT N < 2K complex doubles
  L2    1MB  → fits 3D FFT up to ~40^3
  L3   14MB  → fits 3D FFT up to ~96^3  (64^3 = 4MB  ✓)
  DRAM       → 128^3 = 32MB  (spills L3)   256^3 = 256MB

========================================================================================
  SCENARIO 1 — CPU ONLY (1 thread, scalar baseline)
========================================================================================
  NOTE: Set by compile flag -O2  — no explicit AVX enabled

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    2.027 ms    11.64 GFLOPS | Bwd:    1.975 ms    11.95 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:   11.066 ms     8.53 GFLOPS | Bwd:   11.134 ms     8.48 GFLOPS | Mem:   32.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   29.363 ms     7.50 GFLOPS | Bwd:   29.594 ms     7.44 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:  120.350 ms     7.32 GFLOPS | Bwd:  120.241 ms     7.33 GFLOPS | Mem:  256.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  274.032 ms     7.35 GFLOPS | Bwd:  279.048 ms     7.21 GFLOPS | Mem:  512.0 MB

========================================================================================
  SCENARIO 2 — CPU + AVX-512 (1 thread, vectorized)
========================================================================================
  NOTE: Effective only when compiled with -xCORE-AVX512
        MKL selects AVX-512 kernel automatically

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    2.085 ms    11.31 GFLOPS | Bwd:    2.054 ms    11.49 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:   10.952 ms     8.62 GFLOPS | Bwd:   10.897 ms     8.66 GFLOPS | Mem:   32.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   29.671 ms     7.42 GFLOPS | Bwd:   29.364 ms     7.50 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:  120.554 ms     7.31 GFLOPS | Bwd:  120.648 ms     7.30 GFLOPS | Mem:  256.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  274.667 ms     7.33 GFLOPS | Bwd:  279.189 ms     7.21 GFLOPS | Mem:  512.0 MB

========================================================================================
  SCENARIO 3 — AVX-512 + Multithreaded
========================================================================================
  Threads: 1  (override with: ./fft_benchmark <N>)

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    2.054 ms    11.48 GFLOPS | Bwd:    2.062 ms    11.44 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:   10.982 ms     8.59 GFLOPS | Bwd:   10.818 ms     8.72 GFLOPS | Mem:   32.0 MB
64^3 batch=16          | Grid:   64x  64x  64 | Batch: 16 | Thr: 1 | Fwd:   50.437 ms     7.48 GFLOPS | Bwd:   49.649 ms     7.60 GFLOPS | Mem:  128.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   29.536 ms     7.46 GFLOPS | Bwd:   29.402 ms     7.49 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:  120.933 ms     7.28 GFLOPS | Bwd:  121.239 ms     7.27 GFLOPS | Mem:  256.0 MB
128^3 batch=16         | Grid:  128x 128x 128 | Batch: 16 | Thr: 1 | Fwd:  417.609 ms     8.44 GFLOPS | Bwd:  480.187 ms     7.34 GFLOPS | Mem: 1024.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  273.609 ms     7.36 GFLOPS | Bwd:  278.747 ms     7.22 GFLOPS | Mem:  512.0 MB
256^3 batch=4          | Grid:  256x 256x 256 | Batch:  4 | Thr: 1 | Fwd: 1030.657 ms     7.81 GFLOPS | Bwd: 1062.742 ms     7.58 GFLOPS | Mem: 2048.0 MB

========================================================================================
  SCENARIO 4 — Thread Scaling Sweep (128^3 batch=4)
========================================================================================
  Shows how FFT scales across your 10 physical cores

128^3 thr=1            | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:  121.027 ms     7.28 GFLOPS | Bwd:  121.496 ms     7.25 GFLOPS | Mem:  256.0 MB
128^3 thr=2            | Grid:  128x 128x 128 | Batch:  4 | Thr: 2 | Fwd:   62.985 ms    13.98 GFLOPS | Bwd:   63.357 ms    13.90 GFLOPS | Mem:  256.0 MB
128^3 thr=4            | Grid:  128x 128x 128 | Batch:  4 | Thr: 4 | Fwd:   33.618 ms    26.20 GFLOPS | Bwd:   33.674 ms    26.16 GFLOPS | Mem:  256.0 MB
128^3 thr=8            | Grid:  128x 128x 128 | Batch:  4 | Thr: 8 | Fwd:   21.122 ms    41.70 GFLOPS | Bwd:   21.083 ms    41.78 GFLOPS | Mem:  256.0 MB
128^3 thr=10           | Grid:  128x 128x 128 | Batch:  4 | Thr:10 | Fwd:   16.526 ms    53.30 GFLOPS | Bwd:   16.485 ms    53.43 GFLOPS | Mem:  256.0 MB
128^3 thr=20           | Grid:  128x 128x 128 | Batch:  4 | Thr:20 | Fwd:   15.354 ms    57.37 GFLOPS | Bwd:   15.437 ms    57.06 GFLOPS | Mem:  256.0 MB

========================================================================================
  SCENARIO 5 — Batch Scaling Sweep (128^3, max threads)
========================================================================================
  Shows benefit of batched FFT vs repeated single calls

128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   29.423 ms     7.48 GFLOPS | Bwd:   29.587 ms     7.44 GFLOPS | Mem:   64.0 MB
128^3 batch=2          | Grid:  128x 128x 128 | Batch:  2 | Thr: 1 | Fwd:   59.661 ms     7.38 GFLOPS | Bwd:   59.620 ms     7.39 GFLOPS | Mem:  128.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:  120.236 ms     7.33 GFLOPS | Bwd:  120.898 ms     7.29 GFLOPS | Mem:  256.0 MB
128^3 batch=8          | Grid:  128x 128x 128 | Batch:  8 | Thr: 1 | Fwd:  241.820 ms     7.28 GFLOPS | Bwd:  239.287 ms     7.36 GFLOPS | Mem:  512.0 MB
128^3 batch=16         | Grid:  128x 128x 128 | Batch: 16 | Thr: 1 | Fwd:  415.429 ms     8.48 GFLOPS | Bwd:  492.888 ms     7.15 GFLOPS | Mem: 1024.0 MB
128^3 batch=32         | Grid:  128x 128x 128 | Batch: 32 | Thr: 1 | Fwd:  862.380 ms     8.17 GFLOPS | Bwd:  905.385 ms     7.78 GFLOPS | Mem: 2048.0 MB

########################################################
#                  BENCHMARK COMPLETE                  #
########################################################


real	3m50.231s
user	4m21.083s
sys	0m1.820s

[DONE] Scenario 1 complete

============================================================
 RUNNING: Scenario 2 — AVX-512 (single thread)
 Binary : fft_avx512
 Threads: 1
 ISA    : AVX512
============================================================


########################################################
#         FFT BENCHMARK — Intel MKL DFT                #
#         Random Initialized 3D Complex FFT             #
########################################################
MKL max threads available : 1
Threads requested (cli)   : 1
Timed runs per config     : 20
Warmup runs               : 5 (untimed, stabilize AVX freq)

Column guide:
  Fwd = forward FFT (time + GFLOPS)
  Bwd = inverse FFT (time + GFLOPS)
  Mem = total memory used by in+out buffers

Cache reference (W-2155):
  L1d  32KB  → fits 1D FFT N < 2K complex doubles
  L2    1MB  → fits 3D FFT up to ~40^3
  L3   14MB  → fits 3D FFT up to ~96^3  (64^3 = 4MB  ✓)
  DRAM       → 128^3 = 32MB  (spills L3)   256^3 = 256MB

========================================================================================
  SCENARIO 1 — CPU ONLY (1 thread, scalar baseline)
========================================================================================
  NOTE: Set by compile flag -O2  — no explicit AVX enabled

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    1.118 ms    21.10 GFLOPS | Bwd:    1.103 ms    21.39 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:    7.377 ms    12.79 GFLOPS | Bwd:    7.376 ms    12.79 GFLOPS | Mem:   32.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   20.031 ms    10.99 GFLOPS | Bwd:   20.102 ms    10.95 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   84.411 ms    10.43 GFLOPS | Bwd:   85.649 ms    10.28 GFLOPS | Mem:  256.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  222.980 ms     9.03 GFLOPS | Bwd:  231.406 ms     8.70 GFLOPS | Mem:  512.0 MB

========================================================================================
  SCENARIO 2 — CPU + AVX-512 (1 thread, vectorized)
========================================================================================
  NOTE: Effective only when compiled with -xCORE-AVX512
        MKL selects AVX-512 kernel automatically

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    1.131 ms    20.87 GFLOPS | Bwd:    1.101 ms    21.42 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:    7.454 ms    12.66 GFLOPS | Bwd:    7.401 ms    12.75 GFLOPS | Mem:   32.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   19.654 ms    11.20 GFLOPS | Bwd:   20.153 ms    10.93 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   84.533 ms    10.42 GFLOPS | Bwd:   85.884 ms    10.26 GFLOPS | Mem:  256.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  222.915 ms     9.03 GFLOPS | Bwd:  231.855 ms     8.68 GFLOPS | Mem:  512.0 MB

========================================================================================
  SCENARIO 3 — AVX-512 + Multithreaded
========================================================================================
  Threads: 1  (override with: ./fft_benchmark <N>)

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    1.146 ms    20.58 GFLOPS | Bwd:    1.124 ms    20.98 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:    7.520 ms    12.55 GFLOPS | Bwd:    7.283 ms    12.96 GFLOPS | Mem:   32.0 MB
64^3 batch=16          | Grid:   64x  64x  64 | Batch: 16 | Thr: 1 | Fwd:   34.592 ms    10.91 GFLOPS | Bwd:   34.687 ms    10.88 GFLOPS | Mem:  128.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   20.015 ms    11.00 GFLOPS | Bwd:   20.077 ms    10.97 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   84.701 ms    10.40 GFLOPS | Bwd:   85.958 ms    10.25 GFLOPS | Mem:  256.0 MB
128^3 batch=16         | Grid:  128x 128x 128 | Batch: 16 | Thr: 1 | Fwd:  277.247 ms    12.71 GFLOPS | Bwd:  339.371 ms    10.38 GFLOPS | Mem: 1024.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  222.198 ms     9.06 GFLOPS | Bwd:  230.909 ms     8.72 GFLOPS | Mem:  512.0 MB
256^3 batch=4          | Grid:  256x 256x 256 | Batch:  4 | Thr: 1 | Fwd:  796.834 ms    10.11 GFLOPS | Bwd:  848.536 ms     9.49 GFLOPS | Mem: 2048.0 MB

========================================================================================
  SCENARIO 4 — Thread Scaling Sweep (128^3 batch=4)
========================================================================================
  Shows how FFT scales across your 10 physical cores

128^3 thr=1            | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   84.262 ms    10.45 GFLOPS | Bwd:   86.268 ms    10.21 GFLOPS | Mem:  256.0 MB
128^3 thr=2            | Grid:  128x 128x 128 | Batch:  4 | Thr: 2 | Fwd:   45.375 ms    19.41 GFLOPS | Bwd:   46.532 ms    18.93 GFLOPS | Mem:  256.0 MB
128^3 thr=4            | Grid:  128x 128x 128 | Batch:  4 | Thr: 4 | Fwd:   25.082 ms    35.12 GFLOPS | Bwd:   25.569 ms    34.45 GFLOPS | Mem:  256.0 MB
128^3 thr=8            | Grid:  128x 128x 128 | Batch:  4 | Thr: 8 | Fwd:   17.837 ms    49.38 GFLOPS | Bwd:   17.907 ms    49.19 GFLOPS | Mem:  256.0 MB
128^3 thr=10           | Grid:  128x 128x 128 | Batch:  4 | Thr:10 | Fwd:   14.186 ms    62.09 GFLOPS | Bwd:   14.461 ms    60.91 GFLOPS | Mem:  256.0 MB
128^3 thr=20           | Grid:  128x 128x 128 | Batch:  4 | Thr:20 | Fwd:   14.244 ms    61.84 GFLOPS | Bwd:   14.447 ms    60.97 GFLOPS | Mem:  256.0 MB

========================================================================================
  SCENARIO 5 — Batch Scaling Sweep (128^3, max threads)
========================================================================================
  Shows benefit of batched FFT vs repeated single calls

128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   19.923 ms    11.05 GFLOPS | Bwd:   20.169 ms    10.92 GFLOPS | Mem:   64.0 MB
128^3 batch=2          | Grid:  128x 128x 128 | Batch:  2 | Thr: 1 | Fwd:   41.548 ms    10.60 GFLOPS | Bwd:   41.986 ms    10.49 GFLOPS | Mem:  128.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   83.645 ms    10.53 GFLOPS | Bwd:   85.677 ms    10.28 GFLOPS | Mem:  256.0 MB
128^3 batch=8          | Grid:  128x 128x 128 | Batch:  8 | Thr: 1 | Fwd:  162.833 ms    10.82 GFLOPS | Bwd:  170.779 ms    10.32 GFLOPS | Mem:  512.0 MB
128^3 batch=16         | Grid:  128x 128x 128 | Batch: 16 | Thr: 1 | Fwd:  276.025 ms    12.76 GFLOPS | Bwd:  339.022 ms    10.39 GFLOPS | Mem: 1024.0 MB
128^3 batch=32         | Grid:  128x 128x 128 | Batch: 32 | Thr: 1 | Fwd:  572.801 ms    12.30 GFLOPS | Bwd:  617.056 ms    11.42 GFLOPS | Mem: 2048.0 MB

########################################################
#                  BENCHMARK COMPLETE                  #
########################################################


real	2m50.861s
user	3m17.040s
sys	0m1.837s

[DONE] Scenario 2 complete

============================================================
 RUNNING: Scenario 3 — AVX-512 + physical cores
 Binary : fft_avx512
 Threads: 10
 ISA    : AVX512
============================================================


########################################################
#         FFT BENCHMARK — Intel MKL DFT                #
#         Random Initialized 3D Complex FFT             #
########################################################
MKL max threads available : 10
Threads requested (cli)   : 10
Timed runs per config     : 20
Warmup runs               : 5 (untimed, stabilize AVX freq)

Column guide:
  Fwd = forward FFT (time + GFLOPS)
  Bwd = inverse FFT (time + GFLOPS)
  Mem = total memory used by in+out buffers

Cache reference (W-2155):
  L1d  32KB  → fits 1D FFT N < 2K complex doubles
  L2    1MB  → fits 3D FFT up to ~40^3
  L3   14MB  → fits 3D FFT up to ~96^3  (64^3 = 4MB  ✓)
  DRAM       → 128^3 = 32MB  (spills L3)   256^3 = 256MB

========================================================================================
  SCENARIO 1 — CPU ONLY (1 thread, scalar baseline)
========================================================================================
  NOTE: Set by compile flag -O2  — no explicit AVX enabled

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    1.143 ms    20.65 GFLOPS | Bwd:    1.126 ms    20.95 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:    7.323 ms    12.89 GFLOPS | Bwd:    7.404 ms    12.75 GFLOPS | Mem:   32.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   19.994 ms    11.01 GFLOPS | Bwd:   20.461 ms    10.76 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   84.372 ms    10.44 GFLOPS | Bwd:   85.893 ms    10.25 GFLOPS | Mem:  256.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  217.349 ms     9.26 GFLOPS | Bwd:  226.671 ms     8.88 GFLOPS | Mem:  512.0 MB

========================================================================================
  SCENARIO 2 — CPU + AVX-512 (1 thread, vectorized)
========================================================================================
  NOTE: Effective only when compiled with -xCORE-AVX512
        MKL selects AVX-512 kernel automatically

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    1.113 ms    21.19 GFLOPS | Bwd:    1.134 ms    20.80 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:    7.428 ms    12.70 GFLOPS | Bwd:    7.138 ms    13.22 GFLOPS | Mem:   32.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   19.926 ms    11.05 GFLOPS | Bwd:   20.275 ms    10.86 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   83.934 ms    10.49 GFLOPS | Bwd:   85.723 ms    10.28 GFLOPS | Mem:  256.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  217.328 ms     9.26 GFLOPS | Bwd:  226.578 ms     8.89 GFLOPS | Mem:  512.0 MB

========================================================================================
  SCENARIO 3 — AVX-512 + Multithreaded
========================================================================================
  Threads: 10  (override with: ./fft_benchmark <N>)

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr:10 | Fwd:    0.202 ms   116.71 GFLOPS | Bwd:    0.192 ms   123.01 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr:10 | Fwd:    0.869 ms   108.62 GFLOPS | Bwd:    0.876 ms   107.72 GFLOPS | Mem:   32.0 MB
64^3 batch=16          | Grid:   64x  64x  64 | Batch: 16 | Thr:10 | Fwd:    6.224 ms    60.65 GFLOPS | Bwd:    6.185 ms    61.03 GFLOPS | Mem:  128.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr:10 | Fwd:    3.200 ms    68.80 GFLOPS | Bwd:    3.531 ms    62.37 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr:10 | Fwd:   14.289 ms    61.64 GFLOPS | Bwd:   14.525 ms    60.64 GFLOPS | Mem:  256.0 MB
128^3 batch=16         | Grid:  128x 128x 128 | Batch: 16 | Thr:10 | Fwd:   48.220 ms    73.07 GFLOPS | Bwd:   56.831 ms    61.99 GFLOPS | Mem: 1024.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr:10 | Fwd:   33.869 ms    59.44 GFLOPS | Bwd:   35.553 ms    56.63 GFLOPS | Mem:  512.0 MB
256^3 batch=4          | Grid:  256x 256x 256 | Batch:  4 | Thr:10 | Fwd:  124.462 ms    64.70 GFLOPS | Bwd:  133.722 ms    60.22 GFLOPS | Mem: 2048.0 MB

========================================================================================
  SCENARIO 4 — Thread Scaling Sweep (128^3 batch=4)
========================================================================================
  Shows how FFT scales across your 10 physical cores

128^3 thr=1            | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   83.899 ms    10.50 GFLOPS | Bwd:   85.603 ms    10.29 GFLOPS | Mem:  256.0 MB
128^3 thr=2            | Grid:  128x 128x 128 | Batch:  4 | Thr: 2 | Fwd:   45.651 ms    19.29 GFLOPS | Bwd:   45.527 ms    19.35 GFLOPS | Mem:  256.0 MB
128^3 thr=4            | Grid:  128x 128x 128 | Batch:  4 | Thr: 4 | Fwd:   24.860 ms    35.43 GFLOPS | Bwd:   24.827 ms    35.48 GFLOPS | Mem:  256.0 MB
128^3 thr=8            | Grid:  128x 128x 128 | Batch:  4 | Thr: 8 | Fwd:   18.075 ms    48.73 GFLOPS | Bwd:   17.954 ms    49.06 GFLOPS | Mem:  256.0 MB
128^3 thr=10           | Grid:  128x 128x 128 | Batch:  4 | Thr:10 | Fwd:   14.262 ms    61.76 GFLOPS | Bwd:   14.509 ms    60.71 GFLOPS | Mem:  256.0 MB
128^3 thr=20           | Grid:  128x 128x 128 | Batch:  4 | Thr:20 | Fwd:   14.299 ms    61.60 GFLOPS | Bwd:   14.492 ms    60.78 GFLOPS | Mem:  256.0 MB

========================================================================================
  SCENARIO 5 — Batch Scaling Sweep (128^3, max threads)
========================================================================================
  Shows benefit of batched FFT vs repeated single calls

128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr:10 | Fwd:    3.307 ms    66.58 GFLOPS | Bwd:    3.287 ms    67.00 GFLOPS | Mem:   64.0 MB
128^3 batch=2          | Grid:  128x 128x 128 | Batch:  2 | Thr:10 | Fwd:    7.168 ms    61.44 GFLOPS | Bwd:    7.233 ms    60.89 GFLOPS | Mem:  128.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr:10 | Fwd:   14.315 ms    61.53 GFLOPS | Bwd:   14.502 ms    60.74 GFLOPS | Mem:  256.0 MB
128^3 batch=8          | Grid:  128x 128x 128 | Batch:  8 | Thr:10 | Fwd:   27.976 ms    62.97 GFLOPS | Bwd:   28.407 ms    62.01 GFLOPS | Mem:  512.0 MB
128^3 batch=16         | Grid:  128x 128x 128 | Batch: 16 | Thr:10 | Fwd:   47.781 ms    73.74 GFLOPS | Bwd:   57.446 ms    61.33 GFLOPS | Mem: 1024.0 MB
128^3 batch=32         | Grid:  128x 128x 128 | Batch: 32 | Thr:10 | Fwd:   99.862 ms    70.56 GFLOPS | Bwd:  110.218 ms    63.93 GFLOPS | Mem: 2048.0 MB

########################################################
#                  BENCHMARK COMPLETE                  #
########################################################


real	1m10.344s
user	4m32.415s
sys	0m1.876s

[DONE] Scenario 3 complete

============================================================
 RUNNING: Scenario 3b — AVX-512 + logical cores (hyperthreading)
 Binary : fft_avx512
 Threads: 20
 ISA    : AVX512
============================================================


########################################################
#         FFT BENCHMARK — Intel MKL DFT                #
#         Random Initialized 3D Complex FFT             #
########################################################
MKL max threads available : 20
Threads requested (cli)   : 20
Timed runs per config     : 20
Warmup runs               : 5 (untimed, stabilize AVX freq)

Column guide:
  Fwd = forward FFT (time + GFLOPS)
  Bwd = inverse FFT (time + GFLOPS)
  Mem = total memory used by in+out buffers

Cache reference (W-2155):
  L1d  32KB  → fits 1D FFT N < 2K complex doubles
  L2    1MB  → fits 3D FFT up to ~40^3
  L3   14MB  → fits 3D FFT up to ~96^3  (64^3 = 4MB  ✓)
  DRAM       → 128^3 = 32MB  (spills L3)   256^3 = 256MB

========================================================================================
  SCENARIO 1 — CPU ONLY (1 thread, scalar baseline)
========================================================================================
  NOTE: Set by compile flag -O2  — no explicit AVX enabled

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    1.146 ms    20.59 GFLOPS | Bwd:    1.128 ms    20.92 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:    7.462 ms    12.65 GFLOPS | Bwd:    7.499 ms    12.58 GFLOPS | Mem:   32.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   20.037 ms    10.99 GFLOPS | Bwd:   20.331 ms    10.83 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   84.590 ms    10.41 GFLOPS | Bwd:   85.977 ms    10.24 GFLOPS | Mem:  256.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  223.489 ms     9.01 GFLOPS | Bwd:  237.152 ms     8.49 GFLOPS | Mem:  512.0 MB

========================================================================================
  SCENARIO 2 — CPU + AVX-512 (1 thread, vectorized)
========================================================================================
  NOTE: Effective only when compiled with -xCORE-AVX512
        MKL selects AVX-512 kernel automatically

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    1.162 ms    20.30 GFLOPS | Bwd:    1.137 ms    20.74 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:    7.472 ms    12.63 GFLOPS | Bwd:    7.276 ms    12.97 GFLOPS | Mem:   32.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   19.966 ms    11.03 GFLOPS | Bwd:   20.212 ms    10.89 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   84.609 ms    10.41 GFLOPS | Bwd:   85.765 ms    10.27 GFLOPS | Mem:  256.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  223.700 ms     9.00 GFLOPS | Bwd:  237.301 ms     8.48 GFLOPS | Mem:  512.0 MB

========================================================================================
  SCENARIO 3 — AVX-512 + Multithreaded
========================================================================================
  Threads: 20  (override with: ./fft_benchmark <N>)

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr:20 | Fwd:    0.194 ms   121.93 GFLOPS | Bwd:    0.255 ms    92.59 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr:20 | Fwd:    0.872 ms   108.20 GFLOPS | Bwd:    0.844 ms   111.79 GFLOPS | Mem:   32.0 MB
64^3 batch=16          | Grid:   64x  64x  64 | Batch: 16 | Thr:20 | Fwd:    5.992 ms    63.00 GFLOPS | Bwd:    5.991 ms    63.01 GFLOPS | Mem:  128.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr:20 | Fwd:    3.273 ms    67.27 GFLOPS | Bwd:    3.437 ms    64.07 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr:20 | Fwd:   14.306 ms    61.57 GFLOPS | Bwd:   14.457 ms    60.93 GFLOPS | Mem:  256.0 MB
128^3 batch=16         | Grid:  128x 128x 128 | Batch: 16 | Thr:20 | Fwd:   47.665 ms    73.92 GFLOPS | Bwd:   55.959 ms    62.96 GFLOPS | Mem: 1024.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr:20 | Fwd:   34.478 ms    58.39 GFLOPS | Bwd:   37.968 ms    53.03 GFLOPS | Mem:  512.0 MB
256^3 batch=4          | Grid:  256x 256x 256 | Batch:  4 | Thr:20 | Fwd:  121.851 ms    66.09 GFLOPS | Bwd:  128.768 ms    62.54 GFLOPS | Mem: 2048.0 MB

========================================================================================
  SCENARIO 4 — Thread Scaling Sweep (128^3 batch=4)
========================================================================================
  Shows how FFT scales across your 10 physical cores

128^3 thr=1            | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   83.760 ms    10.52 GFLOPS | Bwd:   85.138 ms    10.35 GFLOPS | Mem:  256.0 MB
128^3 thr=2            | Grid:  128x 128x 128 | Batch:  4 | Thr: 2 | Fwd:   45.858 ms    19.21 GFLOPS | Bwd:   45.677 ms    19.28 GFLOPS | Mem:  256.0 MB
128^3 thr=4            | Grid:  128x 128x 128 | Batch:  4 | Thr: 4 | Fwd:   24.796 ms    35.52 GFLOPS | Bwd:   24.461 ms    36.01 GFLOPS | Mem:  256.0 MB
128^3 thr=8            | Grid:  128x 128x 128 | Batch:  4 | Thr: 8 | Fwd:   17.973 ms    49.01 GFLOPS | Bwd:   18.319 ms    48.08 GFLOPS | Mem:  256.0 MB
128^3 thr=10           | Grid:  128x 128x 128 | Batch:  4 | Thr:10 | Fwd:   14.332 ms    61.46 GFLOPS | Bwd:   14.506 ms    60.72 GFLOPS | Mem:  256.0 MB
128^3 thr=20           | Grid:  128x 128x 128 | Batch:  4 | Thr:20 | Fwd:   14.262 ms    61.76 GFLOPS | Bwd:   14.552 ms    60.53 GFLOPS | Mem:  256.0 MB

========================================================================================
  SCENARIO 5 — Batch Scaling Sweep (128^3, max threads)
========================================================================================
  Shows benefit of batched FFT vs repeated single calls

128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr:20 | Fwd:    3.485 ms    63.19 GFLOPS | Bwd:    3.265 ms    67.44 GFLOPS | Mem:   64.0 MB
128^3 batch=2          | Grid:  128x 128x 128 | Batch:  2 | Thr:20 | Fwd:    7.159 ms    61.52 GFLOPS | Bwd:    7.309 ms    60.26 GFLOPS | Mem:  128.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr:20 | Fwd:   14.222 ms    61.93 GFLOPS | Bwd:   14.532 ms    60.61 GFLOPS | Mem:  256.0 MB
128^3 batch=8          | Grid:  128x 128x 128 | Batch:  8 | Thr:20 | Fwd:   27.302 ms    64.52 GFLOPS | Bwd:   29.002 ms    60.74 GFLOPS | Mem:  512.0 MB
128^3 batch=16         | Grid:  128x 128x 128 | Batch: 16 | Thr:20 | Fwd:   47.678 ms    73.90 GFLOPS | Bwd:   56.137 ms    62.76 GFLOPS | Mem: 1024.0 MB
128^3 batch=32         | Grid:  128x 128x 128 | Batch: 32 | Thr:20 | Fwd:   99.393 ms    70.89 GFLOPS | Bwd:  106.546 ms    66.14 GFLOPS | Mem: 2048.0 MB

########################################################
#                  BENCHMARK COMPLETE                  #
########################################################


real	1m10.865s
user	7m44.252s
sys	0m1.982s

[DONE] Scenario 3b complete

============================================================
 EXTRA: MKL_VERBOSE=1 quick check
============================================================

MKL_VERBOSE oneMKL 2025 Update 3 Product build 20251007 for Intel(R) 64 architecture Intel(R) Advanced Vector Extensions 512 (Intel(R) AVX-512) enabled processors, Lnx 3.30GHz intel_thread
MKL_VERBOSE FFT(dcfi64x64x64,input_strides:{0,4096,64,1},output_strides:{0,4096,64,1},tLim:1,desc:0x11e5480) 3.58ms CNR:OFF Dyn:0 FastMM:1 TID:0  NThr:1

============================================================
  SUMMARY (128^3 batch=4, Forward GFLOPS)
============================================================
  Scenario 1   : 7.32 GFLOPS
  Scenario 2   : 10.43 GFLOPS  (speedup vs S1: 1.42x)
  Scenario 3   : 61.64 GFLOPS (speedup vs S1: 8.42x)
  Scenario 3b  : 61.57 GFLOPS (speedup vs S1: 8.41x)
============================================================

============================================================
  ALL RUNS COMPLETE
  Log saved to: ./fft_logs/fft_benchmark_20260217_154848.log
  451 lines logged
  Run completed at: Tue Feb 17 15:57:52 IST 2026
============================================================

To inspect full output:
  cat ./fft_logs/fft_benchmark_20260217_154848.log

To extract scenario markers + GFLOPS:
  grep -E 'RUNNING:|SCENARIO|GFLOPS|SUMMARY' ./fft_logs/fft_benchmark_20260217_154848.log
