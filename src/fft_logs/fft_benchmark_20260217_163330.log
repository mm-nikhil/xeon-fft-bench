============================================================
  FFT BENCHMARK RUN
  Date     : Tue Feb 17 16:33:30 IST 2026
  Hostname : amdtoolsserver.morphingmachines
  Log file : ./fft_logs/fft_benchmark_20260217_163330.log
============================================================

[SETUP] Sourcing Intel oneAPI environment if available...

[CHECK] MKL environment:
        MKLROOT     = /home/nikhil/.local
        Include dir = /home/nikhil/.local/include
        Lib dir     = /home/nikhil/.local/lib
        Runtime lib = -l:libmkl_rt.so.2

[CHECK] Compiler availability:
        gcc found: gcc (GCC) 8.5.0 20210514 (Red Hat 8.5.0-22)

[INFO] BENCH_NRUNS=20, BENCH_WARMUP=5
[INFO] KMP_AFFINITY=scatter,granularity=fine
[INFO] NOTE: MKL chooses kernels at runtime; ISA is controlled with MKL_ENABLE_INSTRUCTIONS.

------------------------------------------------------------
[COMPILE] Scenario 1 binary: gcc -O2 -std=c99
------------------------------------------------------------
          Binary: fft_cpu_only

------------------------------------------------------------
[COMPILE] Scenario 2/3 binary: gcc -O3 -mavx512f -mavx512dq -mavx512bw -mavx512vl -std=c99
------------------------------------------------------------
          Binary: fft_avx512

============================================================
 RUNNING: Scenario 1 — CPU baseline (single thread)
 Binary : fft_cpu_only
 Threads: 1
 ISA    : SSE4_2
============================================================


########################################################
#         FFT BENCHMARK — Intel MKL DFT                #
#         Random Initialized 3D Complex FFT             #
########################################################
MKL max threads available : 1
Threads requested (cli)   : 1
Timed runs per config     : 20
Warmup runs               : 5 (untimed, stabilize AVX freq)

Column guide:
  Fwd = forward FFT (time + GFLOPS)
  Bwd = inverse FFT (time + GFLOPS)
  Mem = total memory used by in+out buffers

Cache reference (W-2155):
  L1d  32KB  → fits 1D FFT N < 2K complex doubles
  L2    1MB  → fits 3D FFT up to ~40^3
  L3   14MB  → fits 3D FFT up to ~96^3  (64^3 = 4MB  ✓)
  DRAM       → 128^3 = 32MB  (spills L3)   256^3 = 256MB

========================================================================================
  SCENARIO 1 — CPU ONLY (1 thread, scalar baseline)
========================================================================================
  NOTE: Set by compile flag -O2  — no explicit AVX enabled

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    2.140 ms    11.02 GFLOPS | Bwd:    2.036 ms    11.59 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:   10.988 ms     8.59 GFLOPS | Bwd:   10.978 ms     8.60 GFLOPS | Mem:   32.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   30.496 ms     7.22 GFLOPS | Bwd:   30.243 ms     7.28 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:  120.578 ms     7.30 GFLOPS | Bwd:  120.698 ms     7.30 GFLOPS | Mem:  256.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  271.215 ms     7.42 GFLOPS | Bwd:  283.474 ms     7.10 GFLOPS | Mem:  512.0 MB

========================================================================================
  SCENARIO 2 — CPU + AVX-512 (1 thread, vectorized)
========================================================================================
  NOTE: Effective only when compiled with -xCORE-AVX512
        MKL selects AVX-512 kernel automatically

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    2.159 ms    10.93 GFLOPS | Bwd:    2.161 ms    10.92 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:   10.816 ms     8.73 GFLOPS | Bwd:   10.734 ms     8.79 GFLOPS | Mem:   32.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   29.203 ms     7.54 GFLOPS | Bwd:   29.127 ms     7.56 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:  120.827 ms     7.29 GFLOPS | Bwd:  119.782 ms     7.35 GFLOPS | Mem:  256.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  278.672 ms     7.22 GFLOPS | Bwd:  281.073 ms     7.16 GFLOPS | Mem:  512.0 MB

========================================================================================
  SCENARIO 3 — AVX-512 + Multithreaded
========================================================================================
  Threads: 1  (override with: ./fft_benchmark <N>)

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    2.082 ms    11.33 GFLOPS | Bwd:    2.040 ms    11.56 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:   10.937 ms     8.63 GFLOPS | Bwd:   10.690 ms     8.83 GFLOPS | Mem:   32.0 MB
64^3 batch=16          | Grid:   64x  64x  64 | Batch: 16 | Thr: 1 | Fwd:   48.594 ms     7.77 GFLOPS | Bwd:   48.477 ms     7.79 GFLOPS | Mem:  128.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   29.096 ms     7.57 GFLOPS | Bwd:   29.248 ms     7.53 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:  120.414 ms     7.31 GFLOPS | Bwd:  120.179 ms     7.33 GFLOPS | Mem:  256.0 MB
128^3 batch=16         | Grid:  128x 128x 128 | Batch: 16 | Thr: 1 | Fwd:  436.053 ms     8.08 GFLOPS | Bwd:  482.390 ms     7.30 GFLOPS | Mem: 1024.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  285.807 ms     7.04 GFLOPS | Bwd:  281.137 ms     7.16 GFLOPS | Mem:  512.0 MB
256^3 batch=4          | Grid:  256x 256x 256 | Batch:  4 | Thr: 1 | Fwd: 1032.277 ms     7.80 GFLOPS | Bwd: 1082.428 ms     7.44 GFLOPS | Mem: 2048.0 MB

========================================================================================
  SCENARIO 4 — Thread Scaling Sweep (128^3 batch=4)
========================================================================================
  Shows how FFT scales across your 10 physical cores

128^3 thr=1            | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:  120.235 ms     7.33 GFLOPS | Bwd:  119.559 ms     7.37 GFLOPS | Mem:  256.0 MB
128^3 thr=2            | Grid:  128x 128x 128 | Batch:  4 | Thr: 2 | Fwd:   64.490 ms    13.66 GFLOPS | Bwd:   63.234 ms    13.93 GFLOPS | Mem:  256.0 MB
128^3 thr=4            | Grid:  128x 128x 128 | Batch:  4 | Thr: 4 | Fwd:   33.746 ms    26.10 GFLOPS | Bwd:   33.232 ms    26.50 GFLOPS | Mem:  256.0 MB
128^3 thr=8            | Grid:  128x 128x 128 | Batch:  4 | Thr: 8 | Fwd:   22.511 ms    39.13 GFLOPS | Bwd:   21.784 ms    40.43 GFLOPS | Mem:  256.0 MB
128^3 thr=10           | Grid:  128x 128x 128 | Batch:  4 | Thr:10 | Fwd:   19.769 ms    44.55 GFLOPS | Bwd:   17.210 ms    51.18 GFLOPS | Mem:  256.0 MB
128^3 thr=20           | Grid:  128x 128x 128 | Batch:  4 | Thr:20 | Fwd:   15.453 ms    57.00 GFLOPS | Bwd:   15.617 ms    56.40 GFLOPS | Mem:  256.0 MB

========================================================================================
  SCENARIO 5 — Batch Scaling Sweep (128^3, max threads)
========================================================================================
  Shows benefit of batched FFT vs repeated single calls

128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   29.449 ms     7.48 GFLOPS | Bwd:   29.306 ms     7.51 GFLOPS | Mem:   64.0 MB
128^3 batch=2          | Grid:  128x 128x 128 | Batch:  2 | Thr: 1 | Fwd:   59.321 ms     7.42 GFLOPS | Bwd:   59.357 ms     7.42 GFLOPS | Mem:  128.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:  123.752 ms     7.12 GFLOPS | Bwd:  119.644 ms     7.36 GFLOPS | Mem:  256.0 MB
128^3 batch=8          | Grid:  128x 128x 128 | Batch:  8 | Thr: 1 | Fwd:  247.298 ms     7.12 GFLOPS | Bwd:  238.079 ms     7.40 GFLOPS | Mem:  512.0 MB
128^3 batch=16         | Grid:  128x 128x 128 | Batch: 16 | Thr: 1 | Fwd:  432.951 ms     8.14 GFLOPS | Bwd:  496.995 ms     7.09 GFLOPS | Mem: 1024.0 MB
128^3 batch=32         | Grid:  128x 128x 128 | Batch: 32 | Thr: 1 | Fwd:  851.633 ms     8.27 GFLOPS | Bwd:  931.180 ms     7.57 GFLOPS | Mem: 2048.0 MB

########################################################
#                  BENCHMARK COMPLETE                  #
########################################################


real	3m52.465s
user	4m23.978s
sys	0m1.676s

[DONE] Scenario 1 complete

============================================================
 RUNNING: Scenario 2 — AVX-512 (single thread)
 Binary : fft_avx512
 Threads: 1
 ISA    : AVX512
============================================================


########################################################
#         FFT BENCHMARK — Intel MKL DFT                #
#         Random Initialized 3D Complex FFT             #
########################################################
MKL max threads available : 1
Threads requested (cli)   : 1
Timed runs per config     : 20
Warmup runs               : 5 (untimed, stabilize AVX freq)

Column guide:
  Fwd = forward FFT (time + GFLOPS)
  Bwd = inverse FFT (time + GFLOPS)
  Mem = total memory used by in+out buffers

Cache reference (W-2155):
  L1d  32KB  → fits 1D FFT N < 2K complex doubles
  L2    1MB  → fits 3D FFT up to ~40^3
  L3   14MB  → fits 3D FFT up to ~96^3  (64^3 = 4MB  ✓)
  DRAM       → 128^3 = 32MB  (spills L3)   256^3 = 256MB

========================================================================================
  SCENARIO 1 — CPU ONLY (1 thread, scalar baseline)
========================================================================================
  NOTE: Set by compile flag -O2  — no explicit AVX enabled

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    1.146 ms    20.59 GFLOPS | Bwd:    1.122 ms    21.03 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:    7.337 ms    12.86 GFLOPS | Bwd:    7.403 ms    12.75 GFLOPS | Mem:   32.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   19.940 ms    11.04 GFLOPS | Bwd:   20.214 ms    10.89 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   84.089 ms    10.47 GFLOPS | Bwd:   85.418 ms    10.31 GFLOPS | Mem:  256.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  242.891 ms     8.29 GFLOPS | Bwd:  246.403 ms     8.17 GFLOPS | Mem:  512.0 MB

========================================================================================
  SCENARIO 2 — CPU + AVX-512 (1 thread, vectorized)
========================================================================================
  NOTE: Effective only when compiled with -xCORE-AVX512
        MKL selects AVX-512 kernel automatically

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    1.124 ms    20.99 GFLOPS | Bwd:    1.121 ms    21.05 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:    7.427 ms    12.71 GFLOPS | Bwd:    6.993 ms    13.50 GFLOPS | Mem:   32.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   19.858 ms    11.09 GFLOPS | Bwd:   20.009 ms    11.00 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   84.039 ms    10.48 GFLOPS | Bwd:   85.485 ms    10.30 GFLOPS | Mem:  256.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  242.362 ms     8.31 GFLOPS | Bwd:  243.018 ms     8.28 GFLOPS | Mem:  512.0 MB

========================================================================================
  SCENARIO 3 — AVX-512 + Multithreaded
========================================================================================
  Threads: 1  (override with: ./fft_benchmark <N>)

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    1.123 ms    21.01 GFLOPS | Bwd:    1.092 ms    21.61 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:    7.408 ms    12.74 GFLOPS | Bwd:    6.967 ms    13.55 GFLOPS | Mem:   32.0 MB
64^3 batch=16          | Grid:   64x  64x  64 | Batch: 16 | Thr: 1 | Fwd:   34.723 ms    10.87 GFLOPS | Bwd:   34.914 ms    10.81 GFLOPS | Mem:  128.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   19.844 ms    11.10 GFLOPS | Bwd:   20.217 ms    10.89 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   83.692 ms    10.52 GFLOPS | Bwd:   85.040 ms    10.36 GFLOPS | Mem:  256.0 MB
128^3 batch=16         | Grid:  128x 128x 128 | Batch: 16 | Thr: 1 | Fwd:  293.617 ms    12.00 GFLOPS | Bwd:  342.933 ms    10.27 GFLOPS | Mem: 1024.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  242.933 ms     8.29 GFLOPS | Bwd:  243.887 ms     8.25 GFLOPS | Mem:  512.0 MB
256^3 batch=4          | Grid:  256x 256x 256 | Batch:  4 | Thr: 1 | Fwd:  789.104 ms    10.21 GFLOPS | Bwd:  893.691 ms     9.01 GFLOPS | Mem: 2048.0 MB

========================================================================================
  SCENARIO 4 — Thread Scaling Sweep (128^3 batch=4)
========================================================================================
  Shows how FFT scales across your 10 physical cores

128^3 thr=1            | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   84.373 ms    10.44 GFLOPS | Bwd:   85.745 ms    10.27 GFLOPS | Mem:  256.0 MB
128^3 thr=2            | Grid:  128x 128x 128 | Batch:  4 | Thr: 2 | Fwd:   44.532 ms    19.78 GFLOPS | Bwd:   45.921 ms    19.18 GFLOPS | Mem:  256.0 MB
128^3 thr=4            | Grid:  128x 128x 128 | Batch:  4 | Thr: 4 | Fwd:   25.245 ms    34.89 GFLOPS | Bwd:   25.151 ms    35.02 GFLOPS | Mem:  256.0 MB
128^3 thr=8            | Grid:  128x 128x 128 | Batch:  4 | Thr: 8 | Fwd:   17.763 ms    49.59 GFLOPS | Bwd:   17.815 ms    49.44 GFLOPS | Mem:  256.0 MB
128^3 thr=10           | Grid:  128x 128x 128 | Batch:  4 | Thr:10 | Fwd:   14.423 ms    61.07 GFLOPS | Bwd:   14.403 ms    61.15 GFLOPS | Mem:  256.0 MB
128^3 thr=20           | Grid:  128x 128x 128 | Batch:  4 | Thr:20 | Fwd:   14.067 ms    62.61 GFLOPS | Bwd:   14.344 ms    61.40 GFLOPS | Mem:  256.0 MB

========================================================================================
  SCENARIO 5 — Batch Scaling Sweep (128^3, max threads)
========================================================================================
  Shows benefit of batched FFT vs repeated single calls

128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   19.906 ms    11.06 GFLOPS | Bwd:   20.007 ms    11.01 GFLOPS | Mem:   64.0 MB
128^3 batch=2          | Grid:  128x 128x 128 | Batch:  2 | Thr: 1 | Fwd:   41.447 ms    10.63 GFLOPS | Bwd:   41.783 ms    10.54 GFLOPS | Mem:  128.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   83.897 ms    10.50 GFLOPS | Bwd:   85.091 ms    10.35 GFLOPS | Mem:  256.0 MB
128^3 batch=8          | Grid:  128x 128x 128 | Batch:  8 | Thr: 1 | Fwd:  168.589 ms    10.45 GFLOPS | Bwd:  169.774 ms    10.38 GFLOPS | Mem:  512.0 MB
128^3 batch=16         | Grid:  128x 128x 128 | Batch: 16 | Thr: 1 | Fwd:  289.970 ms    12.15 GFLOPS | Bwd:  343.701 ms    10.25 GFLOPS | Mem: 1024.0 MB
128^3 batch=32         | Grid:  128x 128x 128 | Batch: 32 | Thr: 1 | Fwd:  563.490 ms    12.50 GFLOPS | Bwd:  635.870 ms    11.08 GFLOPS | Mem: 2048.0 MB

########################################################
#                  BENCHMARK COMPLETE                  #
########################################################


real	2m54.634s
user	3m20.821s
sys	0m1.677s

[DONE] Scenario 2 complete

============================================================
 RUNNING: Scenario 3 — AVX-512 + physical cores
 Binary : fft_avx512
 Threads: 10
 ISA    : AVX512
============================================================


########################################################
#         FFT BENCHMARK — Intel MKL DFT                #
#         Random Initialized 3D Complex FFT             #
########################################################
MKL max threads available : 10
Threads requested (cli)   : 10
Timed runs per config     : 20
Warmup runs               : 5 (untimed, stabilize AVX freq)

Column guide:
  Fwd = forward FFT (time + GFLOPS)
  Bwd = inverse FFT (time + GFLOPS)
  Mem = total memory used by in+out buffers

Cache reference (W-2155):
  L1d  32KB  → fits 1D FFT N < 2K complex doubles
  L2    1MB  → fits 3D FFT up to ~40^3
  L3   14MB  → fits 3D FFT up to ~96^3  (64^3 = 4MB  ✓)
  DRAM       → 128^3 = 32MB  (spills L3)   256^3 = 256MB

========================================================================================
  SCENARIO 1 — CPU ONLY (1 thread, scalar baseline)
========================================================================================
  NOTE: Set by compile flag -O2  — no explicit AVX enabled

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    1.132 ms    20.83 GFLOPS | Bwd:    1.100 ms    21.44 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:    7.369 ms    12.81 GFLOPS | Bwd:    7.519 ms    12.55 GFLOPS | Mem:   32.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   20.555 ms    10.71 GFLOPS | Bwd:   20.337 ms    10.83 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   84.281 ms    10.45 GFLOPS | Bwd:   86.043 ms    10.24 GFLOPS | Mem:  256.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  244.173 ms     8.25 GFLOPS | Bwd:  247.524 ms     8.13 GFLOPS | Mem:  512.0 MB

========================================================================================
  SCENARIO 2 — CPU + AVX-512 (1 thread, vectorized)
========================================================================================
  NOTE: Effective only when compiled with -xCORE-AVX512
        MKL selects AVX-512 kernel automatically

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    1.124 ms    20.98 GFLOPS | Bwd:    1.099 ms    21.48 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:    7.506 ms    12.57 GFLOPS | Bwd:    7.217 ms    13.08 GFLOPS | Mem:   32.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   20.103 ms    10.95 GFLOPS | Bwd:   20.311 ms    10.84 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   84.214 ms    10.46 GFLOPS | Bwd:   85.242 ms    10.33 GFLOPS | Mem:  256.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  245.832 ms     8.19 GFLOPS | Bwd:  246.347 ms     8.17 GFLOPS | Mem:  512.0 MB

========================================================================================
  SCENARIO 3 — AVX-512 + Multithreaded
========================================================================================
  Threads: 10  (override with: ./fft_benchmark <N>)

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr:10 | Fwd:    0.191 ms   123.28 GFLOPS | Bwd:    0.201 ms   117.44 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr:10 | Fwd:    0.871 ms   108.37 GFLOPS | Bwd:    0.915 ms   103.12 GFLOPS | Mem:   32.0 MB
64^3 batch=16          | Grid:   64x  64x  64 | Batch: 16 | Thr:10 | Fwd:    6.228 ms    60.61 GFLOPS | Bwd:    6.057 ms    62.32 GFLOPS | Mem:  128.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr:10 | Fwd:    3.350 ms    65.73 GFLOPS | Bwd:    3.215 ms    68.49 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr:10 | Fwd:   16.289 ms    54.07 GFLOPS | Bwd:   14.762 ms    59.67 GFLOPS | Mem:  256.0 MB
128^3 batch=16         | Grid:  128x 128x 128 | Batch: 16 | Thr:10 | Fwd:   55.616 ms    63.35 GFLOPS | Bwd:   57.612 ms    61.15 GFLOPS | Mem: 1024.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr:10 | Fwd:   35.213 ms    57.17 GFLOPS | Bwd:   35.018 ms    57.49 GFLOPS | Mem:  512.0 MB
256^3 batch=4          | Grid:  256x 256x 256 | Batch:  4 | Thr:10 | Fwd:  123.752 ms    65.07 GFLOPS | Bwd:  136.298 ms    59.08 GFLOPS | Mem: 2048.0 MB

========================================================================================
  SCENARIO 4 — Thread Scaling Sweep (128^3 batch=4)
========================================================================================
  Shows how FFT scales across your 10 physical cores

128^3 thr=1            | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   84.059 ms    10.48 GFLOPS | Bwd:   85.949 ms    10.25 GFLOPS | Mem:  256.0 MB
128^3 thr=2            | Grid:  128x 128x 128 | Batch:  4 | Thr: 2 | Fwd:   46.573 ms    18.91 GFLOPS | Bwd:   46.764 ms    18.83 GFLOPS | Mem:  256.0 MB
128^3 thr=4            | Grid:  128x 128x 128 | Batch:  4 | Thr: 4 | Fwd:   24.784 ms    35.54 GFLOPS | Bwd:   25.610 ms    34.39 GFLOPS | Mem:  256.0 MB
128^3 thr=8            | Grid:  128x 128x 128 | Batch:  4 | Thr: 8 | Fwd:   17.942 ms    49.09 GFLOPS | Bwd:   18.292 ms    48.15 GFLOPS | Mem:  256.0 MB
128^3 thr=10           | Grid:  128x 128x 128 | Batch:  4 | Thr:10 | Fwd:   14.479 ms    60.83 GFLOPS | Bwd:   15.271 ms    57.68 GFLOPS | Mem:  256.0 MB
128^3 thr=20           | Grid:  128x 128x 128 | Batch:  4 | Thr:20 | Fwd:   14.282 ms    61.67 GFLOPS | Bwd:   14.637 ms    60.18 GFLOPS | Mem:  256.0 MB

========================================================================================
  SCENARIO 5 — Batch Scaling Sweep (128^3, max threads)
========================================================================================
  Shows benefit of batched FFT vs repeated single calls

128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr:10 | Fwd:    3.265 ms    67.44 GFLOPS | Bwd:    3.417 ms    64.45 GFLOPS | Mem:   64.0 MB
128^3 batch=2          | Grid:  128x 128x 128 | Batch:  2 | Thr:10 | Fwd:    7.215 ms    61.04 GFLOPS | Bwd:    7.201 ms    61.16 GFLOPS | Mem:  128.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr:10 | Fwd:   14.561 ms    60.49 GFLOPS | Bwd:   14.675 ms    60.02 GFLOPS | Mem:  256.0 MB
128^3 batch=8          | Grid:  128x 128x 128 | Batch:  8 | Thr:10 | Fwd:   29.077 ms    60.58 GFLOPS | Bwd:   32.141 ms    54.81 GFLOPS | Mem:  512.0 MB
128^3 batch=16         | Grid:  128x 128x 128 | Batch: 16 | Thr:10 | Fwd:   63.182 ms    55.76 GFLOPS | Bwd:   58.063 ms    60.68 GFLOPS | Mem: 1024.0 MB
128^3 batch=32         | Grid:  128x 128x 128 | Batch: 32 | Thr:10 | Fwd:   97.624 ms    72.18 GFLOPS | Bwd:  113.549 ms    62.06 GFLOPS | Mem: 2048.0 MB

########################################################
#                  BENCHMARK COMPLETE                  #
########################################################


real	1m13.255s
user	4m40.704s
sys	0m1.683s

[DONE] Scenario 3 complete

============================================================
 RUNNING: Scenario 3b — AVX-512 + logical cores (hyperthreading)
 Binary : fft_avx512
 Threads: 20
 ISA    : AVX512
============================================================


########################################################
#         FFT BENCHMARK — Intel MKL DFT                #
#         Random Initialized 3D Complex FFT             #
########################################################
MKL max threads available : 20
Threads requested (cli)   : 20
Timed runs per config     : 20
Warmup runs               : 5 (untimed, stabilize AVX freq)

Column guide:
  Fwd = forward FFT (time + GFLOPS)
  Bwd = inverse FFT (time + GFLOPS)
  Mem = total memory used by in+out buffers

Cache reference (W-2155):
  L1d  32KB  → fits 1D FFT N < 2K complex doubles
  L2    1MB  → fits 3D FFT up to ~40^3
  L3   14MB  → fits 3D FFT up to ~96^3  (64^3 = 4MB  ✓)
  DRAM       → 128^3 = 32MB  (spills L3)   256^3 = 256MB

========================================================================================
  SCENARIO 1 — CPU ONLY (1 thread, scalar baseline)
========================================================================================
  NOTE: Set by compile flag -O2  — no explicit AVX enabled

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    1.169 ms    20.18 GFLOPS | Bwd:    1.107 ms    21.31 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:    7.564 ms    12.48 GFLOPS | Bwd:    7.543 ms    12.51 GFLOPS | Mem:   32.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   20.160 ms    10.92 GFLOPS | Bwd:   20.474 ms    10.76 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   84.562 ms    10.42 GFLOPS | Bwd:   86.417 ms    10.19 GFLOPS | Mem:  256.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  242.576 ms     8.30 GFLOPS | Bwd:  249.236 ms     8.08 GFLOPS | Mem:  512.0 MB

========================================================================================
  SCENARIO 2 — CPU + AVX-512 (1 thread, vectorized)
========================================================================================
  NOTE: Effective only when compiled with -xCORE-AVX512
        MKL selects AVX-512 kernel automatically

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr: 1 | Fwd:    1.138 ms    20.73 GFLOPS | Bwd:    1.097 ms    21.51 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr: 1 | Fwd:    7.419 ms    12.72 GFLOPS | Bwd:    7.004 ms    13.47 GFLOPS | Mem:   32.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr: 1 | Fwd:   19.895 ms    11.07 GFLOPS | Bwd:   20.020 ms    11.00 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   84.810 ms    10.39 GFLOPS | Bwd:   86.187 ms    10.22 GFLOPS | Mem:  256.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr: 1 | Fwd:  244.846 ms     8.22 GFLOPS | Bwd:  247.082 ms     8.15 GFLOPS | Mem:  512.0 MB

========================================================================================
  SCENARIO 3 — AVX-512 + Multithreaded
========================================================================================
  Threads: 20  (override with: ./fft_benchmark <N>)

64^3 batch=1           | Grid:   64x  64x  64 | Batch:  1 | Thr:20 | Fwd:    0.244 ms    96.86 GFLOPS | Bwd:    0.191 ms   123.62 GFLOPS | Mem:    8.0 MB
64^3 batch=4           | Grid:   64x  64x  64 | Batch:  4 | Thr:20 | Fwd:    0.830 ms   113.76 GFLOPS | Bwd:    0.845 ms   111.75 GFLOPS | Mem:   32.0 MB
64^3 batch=16          | Grid:   64x  64x  64 | Batch: 16 | Thr:20 | Fwd:    5.989 ms    63.03 GFLOPS | Bwd:    5.983 ms    63.10 GFLOPS | Mem:  128.0 MB
128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr:20 | Fwd:    3.351 ms    65.71 GFLOPS | Bwd:    3.329 ms    66.16 GFLOPS | Mem:   64.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr:20 | Fwd:   14.442 ms    60.99 GFLOPS | Bwd:   15.899 ms    55.40 GFLOPS | Mem:  256.0 MB
128^3 batch=16         | Grid:  128x 128x 128 | Batch: 16 | Thr:20 | Fwd:   52.252 ms    67.43 GFLOPS | Bwd:   61.290 ms    57.48 GFLOPS | Mem: 1024.0 MB
256^3 batch=1          | Grid:  256x 256x 256 | Batch:  1 | Thr:20 | Fwd:   36.772 ms    54.75 GFLOPS | Bwd:   36.294 ms    55.47 GFLOPS | Mem:  512.0 MB
256^3 batch=4          | Grid:  256x 256x 256 | Batch:  4 | Thr:20 | Fwd:  122.081 ms    65.97 GFLOPS | Bwd:  154.803 ms    52.02 GFLOPS | Mem: 2048.0 MB

========================================================================================
  SCENARIO 4 — Thread Scaling Sweep (128^3 batch=4)
========================================================================================
  Shows how FFT scales across your 10 physical cores

128^3 thr=1            | Grid:  128x 128x 128 | Batch:  4 | Thr: 1 | Fwd:   85.660 ms    10.28 GFLOPS | Bwd:   85.141 ms    10.35 GFLOPS | Mem:  256.0 MB
128^3 thr=2            | Grid:  128x 128x 128 | Batch:  4 | Thr: 2 | Fwd:   46.266 ms    19.04 GFLOPS | Bwd:   49.270 ms    17.88 GFLOPS | Mem:  256.0 MB
128^3 thr=4            | Grid:  128x 128x 128 | Batch:  4 | Thr: 4 | Fwd:   26.208 ms    33.61 GFLOPS | Bwd:   24.982 ms    35.26 GFLOPS | Mem:  256.0 MB
128^3 thr=8            | Grid:  128x 128x 128 | Batch:  4 | Thr: 8 | Fwd:   17.719 ms    49.71 GFLOPS | Bwd:   18.328 ms    48.06 GFLOPS | Mem:  256.0 MB
128^3 thr=10           | Grid:  128x 128x 128 | Batch:  4 | Thr:10 | Fwd:   17.527 ms    50.25 GFLOPS | Bwd:   17.685 ms    49.80 GFLOPS | Mem:  256.0 MB
128^3 thr=20           | Grid:  128x 128x 128 | Batch:  4 | Thr:20 | Fwd:   14.535 ms    60.60 GFLOPS | Bwd:   14.755 ms    59.69 GFLOPS | Mem:  256.0 MB

========================================================================================
  SCENARIO 5 — Batch Scaling Sweep (128^3, max threads)
========================================================================================
  Shows benefit of batched FFT vs repeated single calls

128^3 batch=1          | Grid:  128x 128x 128 | Batch:  1 | Thr:20 | Fwd:    3.286 ms    67.01 GFLOPS | Bwd:    3.216 ms    68.48 GFLOPS | Mem:   64.0 MB
128^3 batch=2          | Grid:  128x 128x 128 | Batch:  2 | Thr:20 | Fwd:   14.788 ms    29.78 GFLOPS | Bwd:   12.700 ms    34.68 GFLOPS | Mem:  128.0 MB
128^3 batch=4          | Grid:  128x 128x 128 | Batch:  4 | Thr:20 | Fwd:   14.817 ms    59.45 GFLOPS | Bwd:   15.121 ms    58.25 GFLOPS | Mem:  256.0 MB
128^3 batch=8          | Grid:  128x 128x 128 | Batch:  8 | Thr:20 | Fwd:   31.074 ms    56.69 GFLOPS | Bwd:   30.035 ms    58.65 GFLOPS | Mem:  512.0 MB
128^3 batch=16         | Grid:  128x 128x 128 | Batch: 16 | Thr:20 | Fwd:   56.447 ms    62.42 GFLOPS | Bwd:   57.171 ms    61.63 GFLOPS | Mem: 1024.0 MB
128^3 batch=32         | Grid:  128x 128x 128 | Batch: 32 | Thr:20 | Fwd:  112.342 ms    62.72 GFLOPS | Bwd:  120.484 ms    58.48 GFLOPS | Mem: 2048.0 MB

########################################################
#                  BENCHMARK COMPLETE                  #
########################################################


real	1m14.545s
user	8m3.157s
sys	0m1.826s

[DONE] Scenario 3b complete

============================================================
 EXTRA: MKL_VERBOSE=1 quick check
============================================================

MKL_VERBOSE oneMKL 2025 Update 3 Product build 20251007 for Intel(R) 64 architecture Intel(R) Advanced Vector Extensions 512 (Intel(R) AVX-512) enabled processors, Lnx 3.30GHz intel_thread
MKL_VERBOSE FFT(dcfi64x64x64,input_strides:{0,4096,64,1},output_strides:{0,4096,64,1},tLim:1,desc:0x86b480) 3.61ms CNR:OFF Dyn:0 FastMM:1 TID:0  NThr:1

============================================================
  SUMMARY (128^3 batch=4, Forward GFLOPS)
============================================================
  Scenario 1   : 7.30 GFLOPS
  Scenario 2   : 10.47 GFLOPS  (speedup vs S1: 1.43x)
  Scenario 3   : 54.07 GFLOPS (speedup vs S1: 7.41x)
  Scenario 3b  : 60.99 GFLOPS (speedup vs S1: 8.35x)
============================================================

============================================================
  ALL RUNS COMPLETE
  Log saved to: ./fft_logs/fft_benchmark_20260217_163330.log
  451 lines logged
  Run completed at: Tue Feb 17 16:42:48 IST 2026
============================================================

To inspect full output:
  cat ./fft_logs/fft_benchmark_20260217_163330.log

To extract scenario markers + GFLOPS:
  grep -E 'RUNNING:|SCENARIO|GFLOPS|SUMMARY' ./fft_logs/fft_benchmark_20260217_163330.log
